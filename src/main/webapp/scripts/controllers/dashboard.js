define(["controllers/controllers","modals/askfast"],function(e,t){e.controller("dashboard",["$scope","$rootScope","$timeout","AskFast","Session","Store","dashboardLogsFilter","$q",function(e,t,n,r,i,s,o,u){function h(n){var s=u.defer(),o={method:"outboundCall",params:{adapterID:n.from.configId,address:n.to,url:n.url,bearerToken:f}};return i.auth("Bearer "+f),r.caller("startDialog",null,o).then(function(n){n.error?(s.reject(n),e.alert="Scomething when wrong please try again later, check the logs and request below"):(s.resolve(n),e.alert="sucsessfull request see your resquest below");var r={host:t.config.host,path:"startDialog/outbound",header:{Authrorization:"Bearer "+f},payload:o};e.request=JSON.stringify(r,null,2)}),s.promise}function p(e){var t=u.defer();return f!=""?h(e).then(function(e){promise.resolve(response)}):d().then(function(t){h(e)}),t.promise}function d(){console.log("fetch bearerToken"),i.setHeader("application/x-www-form-urlencoded");var t=u.defer();return r.caller("getAccessToken",null,$.param({client_id:e.user.id,grant_type:"refresh_token",refresh_token:e.user.refreshToken,client_secret:"none"})).then(function(e){e.error?(console.log("bear rejected"),console.log(e),t.reject(e)):(i.setHeader("application/json"),f=e.access_token,t.resolve())}),t.promise}var a=null,f="";e.keyRevealTypeString="password",e.keyButtonString="Show",e.loading={logs:!0};var l=[],c=[];angular.forEach(s("adapters").all(),function(e,t){e.adapterType==="sms"&&l.push(e),e.adapterType==="call"&&c.push(e)}),e.smsAdapters=l,e.phoneAdapters=c,e.sendSMS=function(){var t={type:"sms",to:e.sms.to,url:e.sms.url,from:e.sms.from};p(t).then(function(e){console.log(e)})},e.startCall=function(){var t={type:"call",from:e.call.from,url:e.call.url,to:e.call.to};p(t).then(function(e){console.log(e)})},e.toggleKeyReveal=function(){e.keyRevealTypeString=="password"?(e.keyRevealTypeString="text",e.keyButtonString="Hide",a=n(function(){e.toggleKeyReveal()},5e3)):(a&&(n.cancel(a),a=null),e.keyRevealTypeString="password",e.keyButtonString="Show")},r.caller("log",{limit:100,level:"SEVERE"}).then(function(t){e.logs=o(t),e.loading.logs=!1}),r.caller("info").then(function(e){r.caller("key").then(function(n){e.refreshToken=n.refreshToken,s("app").save({user:e}),t.user=s("app").get("user")})})}])});