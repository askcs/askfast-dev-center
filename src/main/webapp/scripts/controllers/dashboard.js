define(["controllers/controllers","modals/askfast"],function(e,t){e.controller("dashboard",["$scope","$rootScope","$timeout","AskFast","Session","Store","dashboardLogsFilter","$q",function(e,t,n,r,i,s,o,u){function h(t){if(f=="")return p(t);var n=u.defer(),s={method:"outboundCall",params:{adapterID:t.from.configId,address:t.to,url:t.url,bearerToken:f}};return i.auth(f),r.caller("startDialog",null,s).then(function(t){t.error?n.reject(t):(n.resolve(t),e.request={host:"http:api.ask-fast.com/",path:"startDialog/outbound",header:{Authrorization:"Bearer "+f},payload:s})}),n.promise}function p(e){f!=""?h(e):d().then(function(t){h(e)})}function d(){console.log("fetch bearerToken");var t=u.defer();return r.caller("getAccessToken",null,{client_id:e.user.id,grant_type:"refresh_token",refresh_token:e.user.refreshToken,client_secret:"none"}).then(function(e){e.error?(console.log("bear rejected"),console.log(e),t.reject(e)):(f=e.access_token,t.resolve())}),t.promise}var a=null,f="1ff8fff590dcd7a49eca80f506e02cc1";e.keyRevealTypeString="password",e.keyButtonString="Show",e.loading={logs:!0};var l=[],c=[];angular.forEach(s("adapters").all(),function(e,t){e.adapterType==="sms"&&l.push(e),e.adapterType==="call"&&c.push(e)}),e.smsAdapters=l,e.phoneAdapters=c,e.sendSMS=function(){var t={type:"sms",to:e.sms.to,url:e.sms.url,from:e.sms.from};h(t).then(function(e){console.log("reslove"),console.log(e)}).catch(function(e){})},e.startCall=function(){var t={type:"call",from:e.call.from,url:e.call.url,to:e.call.to};h(t).then(function(e){console.log(e)}).catch(function(e){})},e.toggleKeyReveal=function(){e.keyRevealTypeString=="password"?(e.keyRevealTypeString="text",e.keyButtonString="Hide",a=n(function(){e.toggleKeyReveal()},5e3)):(a&&(n.cancel(a),a=null),e.keyRevealTypeString="password",e.keyButtonString="Show")},r.caller("log",{limit:100,level:"SEVERE"}).then(function(t){e.logs=o(t),e.loading.logs=!1}),r.caller("info").then(function(e){r.caller("key").then(function(n){e.refreshToken=n.refreshToken,s("app").save({user:e}),t.user=s("app").get("user")})})}])});