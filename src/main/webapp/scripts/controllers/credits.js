define(["controllers/controllers","modals/askfast"],function(e,t){e.controller("credits",["$scope","$rootScope","$routeParams","$timeout","AskFast","Session","Store","DTOptionsBuilder","DTColumnDefBuilder",function(e,t,n,r,i,s,o,u,a){function l(){i.caller("info").then(function(t){e.paypallink="http://sandbox.ask-fast.com/paymentserver/paypal?accountId="+t.id+"&redirect_url=http://portal.ask-fast.com/#/credits?redirect=succesfullpaypal",o("app").save({user:t})})}function c(t){e.info=!1,e.infomessage=t,r(function(){e.info=!0},3e3)}e.loading=!0,e.PayPal=!1,e.creditButton=!0,e.creditForm=!0,e.info=!0,e.buyButton=!0;var f={};n.redirect=="paypal"&&c("Congratulations your PayPal acount is varified"),l(),i.caller("paymentMethods").then(function(t){angular.forEach(t,function(e){f[e.type]=e.id}),e.methods=t,e.PayPal=!0,e.creditButton=!1}),i.caller("getPayments").then(function(t){e.payments=t,e.loading=!1}),e.dtOptions=u.newOptions().withTableTools("../scripts/libs/datatables/1.10.4/extensions/TableTools/swf/copy_csv_xls_pdf.swf").withTableToolsButtons(["copy","print",{sExtends:"collection",sButtonText:"Save",aButtons:["csv","xls","pdf"]}]).withOption("order",[[0,"desc"]]),e.dtColumnDefs=[a.newColumnDef(0),a.newColumnDef(1),a.newColumnDef(2)],e.paymentform=function(){e.creditButton=!0,e.creditForm=!1},e.proceedToCheckOut=function(){e.checkoutButton=!0,e.buyButton=!1},e.buycredits=function(t){c("Working your request"),console.log(t.method);var n=e.user.id;t&&typeof t.amount!="undefined"&&typeof t.method!="undefined"?(e.creditForm=!0,i.caller("newPayment",null,{paymentMethodId:f[t.method],amount:t.amount}).then(function(e){c("Your payment is succesfull thank you"),l()})):c("Set amount and payment Type")},e.abortSale=function(){e.buyButton=!0}}])});