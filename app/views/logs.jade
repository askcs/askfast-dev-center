navbar

#wrap
  .container-fluid
    section#developer
      .container-fluid
        //- #sub-header.row
        //-   .col-md-12
        //-     ul.list-inline
        //-       li: a(ng-click='vm.setSection("adapters")') Adapters
        //-       li: a(ng-click='vm.setSection("dialogs")') Dialogs
        //-       li: a(ng-click='vm.setSection("debugger")') Debugger
        //- #toolbar.row
        //-   .col-md-10
        //-   .col-md-2.text-right

        section(ng-switch='', on='vm.currentSection')
          
          #widgets.row(ng-switch-when='debugger')
            .col-md-12
              .widget
                .inner
                  header: h2 Debugger
                  section
                    form.form-inline(role='form')
                      .form-group
                        label Adapter Type:
                        select.form-control(ng-model='vm.query.category',
                        ng-change='vm.Log.categorize()')
                          option(value='all') All
                          option(value='call') Phone
                          option(value='email') Email
                          option(value='sms') SMS
                          option(value='xmpp') Gtalk
                          option(value='twitter') Twitter
                      .form-group(style='margin-left: 15px;')
                        label Limit:
                        select.form-control(ng-model='vm.query.limit',
                        ng-change='vm.Log.list()')
                          option(value='100') 100
                          option(value='250') 250
                          option(value='500') 500
                          option(value='1000') 1000
                      .form-group
                        label Logs until 
                          //- span.small.text-muted dd/mm/yyyy
                        input.form-control(ng-model='vm.query.until',
                        ng-change='vm.Log.list()',
                        data-date-type='string',
                        data-date-format='dd/MM/yyyy',
                        bs-datepicker='')
                      .form-group
                        label From 
                        input.form-control(type='text',
                        ng-model='vm.queryLogs.fromAddress')
                      .form-group
                        label To 
                        input.form-control(type='text',
                        ng-model='vm.queryLogs.toAddress')
                      .form-group
                        label Any 
                        input.form-control(type='text',
                        ng-model='vm.queryLogs.$')
                    hr
                    p(ng-show='vm.loading.logs')
                      | Loading logs..
                    p(ng-hide='vm.logs.length > 0 || vm.loading.logs')
                      | Your query has no logs..
                    table.table(ng-show='vm.logs.length > 0')
                      thead
                        tr
                          th Date
                          th Type
                          th Adapter Type
                          th From
                          th To
                      tbody
                        tr(ng-repeat='log in vm.logs | filter:vm.queryLogs | orderBy: "start" : true')
                          td <a href="/#/logs?ddrId={{log._id}}">{{log.startString}}<a>
                          td {{log.ddrTypeString}}
                          td {{log.adapterTypeString}}
                          td {{log.fromAddress}}
                          td {{log.toAddress}}
          #widgets.row(ng-switch-when='details')
            .col-md-12
              .widget
                .inner
                  header: h2 Details for {{vm.ddrId}}
                  section.ddr-detail
                    .row(ng-show="vm.ddrDetails")
                      .col-md-4.col-md-offset-2.ddr-details
                        dl.dl-horizontal
                          dt Type
                          dd {{vm.ddrDetails.ddrTypeString}}
                          dt Adapter Type
                          dd {{vm.ddrDetails.adapterTypeString}}
                          dt Duration
                          dd(ng-show='vm.ddrDetails.duration !== null') {{vm.ddrDetails.duration}} ms
                          dd(ng-show='vm.ddrDetails.duration === null') No duration
                          dt Start Time
                          dd {{vm.ddrDetails.startString}}
                          dt(ng-show='vm.ddrDetails.duration !== null') End Time
                          dd(ng-show='vm.ddrDetails.duration !== null') {{vm.ddrDetails.endString}}
                          hr
                          dt From
                          dd {{vm.ddrDetails.fromAddress}}
                          dt To
                          dd {{vm.ddrDetails.toAddress}}
                      .col-md-4
                        div(ng-show='vm.ddrDetails.statusPerAddress')
                          h5 Address Status
                          dl.dl-horizontal
                            div(ng-repeat='statusObj in vm.ddrDetails.statusPerAddress')
                              dt {{statusObj.index}}
                              dd {{statusObj.status}}
                        div(ng-show='vm.ddrDetails.additionalInfo.message')
                          h5 Message
                          .well
                            pre
                              | {{vm.ddrDetails.additionalInfo.message}}
                          
                      .col-sm-8.col-sm-offset-2
                        .row(ng-show='vm.logs')
                          .col-xs-12
                            button.pull-right.btn.btn-default(ng-click='vm.expandAll()') Expand All
                            button.pull-right.btn.btn-default(ng-click='vm.collapseAll()') Collapse All
                          hr
                      .col-sm-8.col-sm-offset-2
                        div(ng-repeat='log in vm.logs | orderBy: "timestamp"')
                          //.panel(ng-class='log.level === "INFO" ? "panel-primary" : "panel-default"')
                          //.panel(ng-class='{INFO:"panel-info", SEVERE: "panel-danger", DDR: "panel-default", DEBUG: "panel-success", WARNING: "panel-warning" }[log.level]')
                          .panel.panel-default
                            .panel-heading
                              h3.panel-title
                                a(data-toggle='collapse', href='#collapse{{$index}}')
                                  .row
                                    .col-xs-5
                                      | {{log.timeString}}
                                    .col-xs-2
                                      | {{(log.level) ? log.level : '-'}}
                                    .col-xs-2
                                      | {{log.requestLog.httpMethod}}
                                    .col-xs-2
                                      | {{log.responseLog.httpCode}}
                                      
                            .panel-body.panel-collapse.collapse(id='collapse{{$index}}')
                              .row
                                .col-xs-12.col-lg-6(ng-show='log.requestLog')
                                  .row
                                    .col-xs-7.col-xs-offset-5
                                      h4 Request
                                    .col-xs-12
                                      dl
                                        dt Url
                                        dd 
                                          .well
                                            pre {{log.requestLog.url}}
                                        dt Method   
                                        dd {{log.requestLog.httpMethod}}
                                      .collapse-list(ng-show='log.requestLog.headers')
                                        a.collapsed(data-toggle='collapse', href='#req-headers-{{$index}}')
                                          | Headers 
                                      dl.dl-horizontal.collapse(id='req-headers-{{$index}}', ng-show='log.requestLog.headers')
                                        dt(ng-repeat-start='(headerkey, headerVal) in log.requestLog.headers') {{headerkey}}
                                        dd(ng-repeat-end) {{headerVal}}
                                      .collapse-list
                                        a.collapsed(data-toggle='collapse', href='#req-parameters-{{$index}}')
                                          | Parameters 
                                      dl.dl-horizontal.collapse(id='req-parameters-{{$index}}')
                                        dt(ng-repeat-start='(paramKey, paramVal) in log.requestLog.parameters') {{paramKey}}
                                        dd(ng-repeat-end) {{paramVal}}
                                        div(ng-hide='log.requestLog.parameters')
                                          dt -
                                          dd -
                                      h5 Body
                                      .well
                                        pre {{log.requestLog.requestBody}}
                                .col-xs-12.col-lg-6(ng-show='log.responseLog')
                                  .row
                                    .col-xs-7.col-xs-offset-5
                                      h4 Response
                                    .col-xs-12
                                      dl
                                        dt Response Code
                                        dd {{log.responseLog.httpCode}}
                                        dt Response Time
                                        dd {{(log.responseLog.httpResponseTime) ? log.responseLog.httpResponseTime : '-' }} ms
                                      .collapse-list
                                        a.collapsed(data-toggle='collapse', href='#res-headers-{{$index}}')
                                          | Headers 
                                      dl.dl-horizontal.collapse(id='res-headers-{{$index}}')
                                        dt(ng-repeat-start='(headerkey, headerVal) in log.responseLog.headers') {{headerkey}}
                                        dd(ng-repeat-end) {{headerVal}}
                                        div(ng-hide='log.responseLog.headers')
                                          dt -
                                          dd -
                                      h5 Body
                                      .well
                                        pre {{log.responseLog.responseBody}}
                                //- dl
                                  dt Timestamp
                                  dd {{log.timestamp}}
                              div(ng-show='log.message')
                                h5 Message
                                .well
                                  pre {{log.message}}
                    .row(ng-hide="vm.ddrDetails")
                      .col-md-4.col-md-offset-2 Loading log details...
