navbar

#wrap
  .container-fluid
    section#developer
      .container-fluid
        #sub-header.row
          .col-md-12
            ul.list-inline
              li: a(ng-click='vm.setSection("adapters")') Adapters
              li: a(ng-click='vm.setSection("dialogs")') Dialogs
              li: a(ng-click='vm.setSection("debugger")') Debugger
        #toolbar.row
          .col-md-10
          .col-md-2.text-right





        section(ng-switch='', on='vm.currentSection')




          #widgets.row(ng-switch-when='adapters')
            .col-md-12
              .widget
                .inner
                  header
                    h2 Adapters
                    select.form-control(ng-model='vm.adapterType',
                    ng-change='vm.Adapter.query(vm.adapterType)')
                      option(value='', selected) Add a new adapter
                      option(value='email') Email
                      option(value='call') Phone
                      option(value='sms') SMS
                      option(value='xmpp') Gtalk
                      option(value='twitter') Twitter
                  section
                    article(ng-show='vm.adapterType')
                      h3 Available adapters
                      p(ng-hide='vm.freeAdapters.length > 0')
                        | There are not any available adapter for this type.
                      table.table.table-bordered.table-hover(ng-show='vm.freeAdapters.length > 0')
                        thead
                          tr
                            th Adapter
                            th Type
                            th Actions
                        tbody
                          tr(ng-repeat='adapter in vm.freeAdapters')
                            td {{adapter | translateAdapterAddress}}
                            td {{adapter | translateAdapterType}}
                            td
                              button.btn.btn-default.btn-sm(ng-click='vm.Adapter.add(adapter)')
                                | Add to your account
                      hr
                    h3 Your adapters
                    p(ng-hide='vm.adapters.length > 0')
                      | There are not any adapters for your account.
                    table.table.table-bordered.table-hover(ng-show='vm.adapters.length > 0')
                      thead
                        tr
                          th ID
                          th Adapter
                          th Type
                          //th Usage
                          th Actions
                      tbody
                        tr(ng-repeat='adapter in vm.adapters')
                          td {{adapter.configId}}
                          td {{adapter | translateAdapterAddress}}
                          td {{adapter | translateAdapterType}}
                          //td -
                          td
                            button.btn.btn-default.btn-sm(ng-click='Adapter.remove(adapter)')
                              | Remove adapter




          #widgets.row(ng-switch-when='addDialog')
            .col-md-12
              .widget
                .inner
                  header: h2 Add a new dialog
                  section
                    form(role='form', name='forms.addDialog',
                    ng-submit='vm.Dialog.add(dialog)')
                      .row
                        .form-group.col-lg-6.col-md-8(class='{{forms.addDialog.name.$invalid && forms.addDialog.name.$dirty && "has-error"}}')
                          input.form-control(type='text',
                          name='name',
                          ng-model='vm.dialog.form.name',
                          placeholder='Dialog name'
                          required)
                          p
                            span.text-danger(ng-show="forms.addDialog.name.$error.required && forms.addDialog.name.$dirty")
                              | A name is required to make a new dialog.
                      .row
                        .form-group.col-lg-6.col-md-8(class='{{forms.addDialog.url.$invalid && forms.addDialog.url.$dirty && "has-error"}}')
                          input.form-control(type='url',
                          name='url',
                          ng-model='vm.dialog.form.url',
                          placeholder='URL for dialog',
                          required)
                          p
                            span.text-danger(ng-show="forms.addDialog.url.$error.required && forms.addDialog.url.$dirty")
                              | A URL is required to make a new dialog.
                            span.text-danger(ng-show="forms.addDialog.url.$error.url")
                              | The entered URL isn't valid.
                      .form-group
                        button.btn.btn-default(type='submit') Create dialog
                      a(ng-click='vm.setSection("dialogs")') &nbsp; or go back to the list.




          #widgets.row(ng-switch-when='dialogs')
            .col-md-12
              .widget.widget-right
                .inner
                  header
                    h2 Dialogs
                    button.btn.btn-default(type='button',
                    ng-click='vm.setSection("addDialog")') Add a dialog
                  section
                    
                    .row
                      .col-md-3
                        p(ng-hide='vm.loadingDialogs') Hold on dialogs are loading...
                        p(ng-show='vm.dialogs.length < 1')
                          | There are no dialogs yet. Please add one.
                        ul.nav.nav-pills.nav-stacked(ng-hide='vm.dialogs.length < 1')
                          li(ng-repeat='_dialog in vm.dialogs',
                          class='{{(_dialog.id == vm.dialog.id) && "active"}}')
                            a(ng-click='vm.Dialog.open(_dialog)') {{_dialog.name}}
                      .col-md-9(ng-show='vm.dialogs.length < 1')
                      .col-md-9(ng-hide='vm.dialogs.length < 1')
                        .row
                          .col-md-6
                            form(name='forms.details')
                              fieldset
                                legend Details
                                .form-group
                                  label Dialog Id
                                  .row
                                    .col-md-9
                                      input.form-control(ng-model='vm.dialog.id', readonly='')
                                .form-group
                                  label Name
                                  .row
                                    .col-md-9
                                      input.form-control(ng-model='vm.dialog.name')
                                .form-group
                                  label URL
                                  input.form-control(ng-model='vm.dialog.url')
                                .form-group
                                  button.btn.btn-default(ng-click='vm.Dialog.updateDetails(vm.dialog)') Update details
                          .col-md-4
                            form(name='forms.auth')
                              fieldset
                                legend Authentication 
                                  span.small.text-primary(ng-show='vm.dialog.useBasicAuth') &nbsp;enabled
                                p If desired, you can set Basic Authentication credentials for this dialog.
                                p(ng-show='vm.dialogAuth.message', class="{{(vm.dialogAuth.messageType) && 'text-' + vm.dialogAuth.messageType}}")
                                  | {{vm.dialogAuth.message}}
                                div(ng-hide='vm.dialogAuth.open')
                                  .form-group
                                    button.btn.btn-default(ng-click='vm.dialogAuth.open = true') Configure
                                div(ng-show='vm.dialogAuth.open')
                                  .form-group
                                    label Username
                                    input.form-control(name='username', ng-model='vm.dialog.userName')
                                  .form-group
                                    label Password
                                    input.form-control(name='password', ng-model='vm.dialog.password', type='password')
                                  .form-groups
                                    button.btn.btn-default(ng-click='vm.authenticateDialog(dialog)')
                                      | {{(vm.dialog.useBasicAuth) && 'Update' || 'Enable'}}
                                    button.btn.btn-default(ng-click='vm.cancelAuthentication(dialog)')
                                      | Cancel
                                    button.btn.btn-danger.pull-right(ng-click='vm.disableDialogAuthentication(dialog)',
                                      ng-show='vm.dialog.useBasicAuth')
                                      | Disable

                          .col-md-2
                            button.btn.btn-default.btn-danger.pull-right(ng-click='vm.Dialog.remove(dialog)')
                              | Delete dialog
                        .row
                          .col-md-10
                            form(name='forms.adapters', role='form')
                              fieldset
                                legend Adapters
                                .row
                                  .form-group.col-sm-5.col-lg-4
                                    label Type
                                    select.form-control(ng-model='vm.channel.type',
                                    ng-change='vm.channelTypeSelected()')
                                      option(ng-repeat='type in vm.types',
                                      value='{{type}}') {{type}}
                                    span.help-block Please select a type first
                                  .form-group.col-sm-7(ng-hide='(vm.channel.type == null)')
                                        label Adapter
                                        p(ng-hide='vm.candidates.length > 0')
                                          | There are sadly no adapters for this one.
                                        select.form-control(ng-model='vm.channel.adapter',
                                        ng-show='vm.candidates.length > 0')
                                          option(ng-repeat='candidate in vm.candidates',
                                          value='{{candidate.configId}}') {{candidate.myAddress}}
                                        span.help-block Select the adapter
                                .row
                                  .form-group.col-md-12
                                    button.btn.btn-default(type='button',
                                    ng-click='vm.Dialog.adapters.add(dialog)') Link adapter to dialog
                        hr
                        fieldset
                          legend Linked Adapters
                          p(ng-hide='(vm.adapters | filterAdapters: vm.dialog).length > 0')
                            | There are no adapters linked to this dialog yet.
                          table.table.table-bordered.table-hover(
                          ng-show='(vm.adapters | filterAdapters: vm.dialog).length > 0')
                            thead
                              tr
                                th Adapter
                                th Type
                                th Actions
                            tbody
                              tr(ng-repeat='adapter in vm.adapters | filterAdapters: vm.dialog')
                                th {{adapter | translateAdapterAddress}}
                                th {{adapter | translateAdapterType}}
                                th: a(ng-click='vm.Dialog.adapters.remove(adapter)') Remove link




          #widgets.row(ng-switch-when='debugger')
            .col-md-12
              .widget
                .inner
                  header: h2 Debugger
                  section
                    form.form-inline(role='form')
                      .form-group
                        label Adapter Type:
                        select.form-control(ng-model='vm.query.category',
                        ng-change='vm.Log.categorize()')
                          option(value='all') All
                          option(value='call') Phone
                          option(value='email') Email
                          option(value='sms') SMS
                          option(value='xmpp') Gtalk
                          option(value='twitter') Twitter
                      .form-group(style='margin-left: 15px;')
                        label Limit:
                        select.form-control(ng-model='vm.query.limit',
                        ng-change='vm.Log.list()')
                          option(value='100') 100
                          option(value='250') 250
                          option(value='500') 500
                          option(value='1000') 1000
                      .form-group
                        label Logs until 
                          //- span.small.text-muted dd/mm/yyyy
                        input.form-control(ng-model='vm.query.until',
                        ng-change='vm.Log.list()',
                        data-date-type='string',
                        data-date-format='dd/MM/yyyy',
                        bs-datepicker='')
                      .form-group
                        label From 
                        input.form-control(type='text',
                        ng-model='vm.queryLogs.fromAddress')
                      .form-group
                        label To 
                        input.form-control(type='text',
                        ng-model='vm.queryLogs.toAddress')
                      .form-group
                        label Any 
                        input.form-control(type='text',
                        ng-model='vm.queryLogs.$')
                    hr
                    p(ng-show='vm.loading.logs')
                      | Loading logs..
                    p(ng-hide='vm.logs.length > 0 || vm.loading.logs')
                      | Your query has no logs..
                    table.table(ng-show='vm.logs.length > 0')
                      thead
                        tr
                          th Date
                          th Type
                          th Adapter Type
                          th From
                          th To
                      tbody
                        tr(ng-repeat='log in vm.logs | filter:vm.queryLogs | orderBy: "start" : true')
                          td <a href="/#/developer?ddrId={{log._id}}">{{log.startString}}<a>
                          td {{log.ddrTypeString}}
                          td {{log.adapterTypeString}}
                          td {{log.fromAddress}}
                          td {{log.toAddress}}
          #widgets.row(ng-switch-when='details')
            .col-md-12
              .widget
                .inner
                  header: h2 Details for {{vm.ddrId}}
                  section.ddr-detail
                    .row(ng-show="vm.ddrDetails")
                      .col-md-4.col-md-offset-2.ddr-details
                        dl.dl-horizontal
                          dt Type
                          dd {{vm.ddrDetails.ddrTypeString}}
                          dt Adapter Type
                          dd {{vm.ddrDetails.adapterTypeString}}
                          dt Duration
                          dd(ng-show='vm.ddrDetails.duration !== null') {{vm.ddrDetails.duration}} ms
                          dd(ng-show='vm.ddrDetails.duration === null') No duration
                          dt Start Time
                          dd {{vm.ddrDetails.startString}}
                          dt(ng-show='vm.ddrDetails.duration !== null') End Time
                          dd(ng-show='vm.ddrDetails.duration !== null') {{vm.ddrDetails.endString}}
                          hr
                          dt From
                          dd {{vm.ddrDetails.fromAddress}}
                          dt To
                          dd {{vm.ddrDetails.toAddress}}
                      .col-md-4
                        div(ng-show='vm.ddrDetails.statusPerAddress')
                          h5 Address Status
                          dl.dl-horizontal
                            div(ng-repeat='statusObj in vm.ddrDetails.statusPerAddress')
                              dt {{statusObj.index}}
                              dd {{statusObj.status}}
                        div(ng-show='vm.ddrDetails.additionalInfo.message')
                          h5 Message
                          .well
                            pre
                              | {{vm.ddrDetails.additionalInfo.message}}
                          
                      .col-sm-8.col-sm-offset-2
                        .row(ng-show='vm.logs')
                          .col-xs-5
                            strong Time 
                          .col-xs-2
                            strong Level 
                          .col-xs-5
                            button.pull-right.btn.btn-default(ng-click='vm.expandAll()') Expand All
                            button.pull-right.btn.btn-default(ng-click='vm.collapseAll()') Collapse All
                          hr
                      .col-sm-8.col-sm-offset-2
                        div(ng-repeat='log in vm.logs | orderBy: "timestamp"')
                          //.panel(ng-class='log.level === "INFO" ? "panel-primary" : "panel-default"')
                          //.panel(ng-class='{INFO:"panel-info", SEVERE: "panel-danger", DDR: "panel-default", DEBUG: "panel-success", WARNING: "panel-warning" }[log.level]')
                          .panel.panel-default
                            .panel-heading
                              h3.panel-title
                                a(data-toggle='collapse', href='#collapse{{$index}}')
                                  .row
                                    .col-xs-5
                                      | {{log.timeString}}
                                    .col-xs-7
                                      | {{(log.level) ? log.level : '-'}}
                                      
                            .panel-body.panel-collapse.collapse(id='collapse{{$index}}')
                              .row
                                .row.col-xs-12.col-lg-6(ng-show='log.requestLog')
                                  .col-xs-7.col-xs-offset-5
                                    h4 Request
                                  .col-xs-12
                                    dl
                                      dt Url
                                      dd 
                                        .well
                                          pre {{log.requestLog.url}}
                                      dt Method   
                                      dd {{log.requestLog.httpMethod}}
                                    .collapse-list(ng-show='log.requestLog.headers')
                                      a.collapsed(data-toggle='collapse', href='#req-headers-{{$index}}')
                                        | Headers 
                                    dl.dl-horizontal.collapse(id='req-headers-{{$index}}', ng-show='log.requestLog.headers')
                                      dt(ng-repeat-start='(headerkey, headerVal) in log.requestLog.headers') {{headerkey}}
                                      dd(ng-repeat-end) {{headerVal}}
                                    .collapse-list
                                      a.collapsed(data-toggle='collapse', href='#req-parameters-{{$index}}')
                                        | Parameters 
                                    dl.dl-horizontal.collapse(id='req-parameters-{{$index}}')
                                      dt(ng-repeat-start='(paramKey, paramVal) in log.requestLog.parameters') {{paramKey}}
                                      dd(ng-repeat-end) {{paramVal}}
                                      div(ng-hide='log.requestLog.parameters')
                                        dt -
                                        dd -
                                    h5 Body
                                    .well
                                      pre {{log.requestLog.requestBody}}
                                .row.col-xs-12.col-lg-6(ng-show='log.responseLog')
                                  .col-xs-7.col-xs-offset-5
                                    h4 Response
                                  .col-xs-12
                                    dl
                                      dt Response Code
                                      dd {{log.responseLog.httpCode}}
                                      dt Response Time
                                      dd {{(log.responseLog.httpResponseTime) ? log.responseLog.httpResponseTime : '-' }} ms
                                    .collapse-list
                                      a.collapsed(data-toggle='collapse', href='#res-headers-{{$index}}')
                                        | Headers 
                                    dl.dl-horizontal.collapse(id='res-headers-{{$index}}')
                                      dt(ng-repeat-start='(headerkey, headerVal) in log.responseLog.headers') {{headerkey}}
                                      dd(ng-repeat-end) {{headerVal}}
                                      div(ng-hide='log.responseLog.headers')
                                        dt -
                                        dd -
                                    h5 Body
                                    .well
                                      pre {{log.responseLog.responseBody}}
                                //- dl
                                  dt Timestamp
                                  dd {{log.timestamp}}
                              div(ng-show='log.message')
                                h5 Message
                                .well
                                  pre {{log.message}}
                    .row(ng-hide="vm.ddrDetails")
                      .col-md-4.col-md-offset-2 Loading log details...
