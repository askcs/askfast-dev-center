navbar

#wrap
  .container-fluid
    section#developer
      .container-fluid
        #sub-header.row
          .col-md-12
            ul.list-inline
              li: a(ng-click='setSection("adapters")') Adapters
              li: a(ng-click='setSection("dialogs")') Dialogs
              li: a(ng-click='setSection("debugger")') Debugger
        #toolbar.row
          .col-md-10
          .col-md-2.text-right





        section(ng-switch='', on='currentSection')




          #widgets.row(ng-switch-when='adapters')
            .col-md-12
              .widget
                .inner
                  header
                    h2 Adapters
                    //- access parent's scope, since ng-switch creates own scope
                    select.form-control(ng-model='$parent.adapterType',
                    ng-change='Adapter.query($parent.adapterType)')
                      option(value='', selected) Add a new adapter
                      option(value='email') Email
                      option(value='call') Phone
                      option(value='sms') SMS
                      option(value='xmpp') Gtalk
                      option(value='twitter') Twitter
                  section
                    article(ng-show='$parent.adapterType')
                      h3 Available adapters
                      p(ng-hide='freeAdapters.length > 0')
                        | There are not any available adapter for this type.
                      table.table.table-bordered.table-hover(ng-show='freeAdapters.length > 0')
                        thead
                          tr
                            th Adapter
                            th Type
                            th Actions
                        tbody
                          tr(ng-repeat='adapter in freeAdapters')
                            td {{adapter | translateAdapterAddress}}
                            td {{adapter | translateAdapterType}}
                            td
                              button.btn.btn-default.btn-sm(ng-click='Adapter.add(adapter)')
                                | Add to your account
                      hr
                    h3 Your adapters
                    p(ng-hide='adapters.length > 0')
                      | There are not any adapters for your account.
                    table.table.table-bordered.table-hover(ng-show='adapters.length > 0')
                      thead
                        tr
                          th ID
                          th Adapter
                          th Type
                          //th Usage
                          th Actions
                      tbody
                        tr(ng-repeat='adapter in adapters')
                          td {{adapter.configId}}
                          td {{adapter | translateAdapterAddress}}
                          td {{adapter | translateAdapterType}}
                          //td -
                          td
                            button.btn.btn-default.btn-sm(ng-click='Adapter.remove(adapter)')
                              | Remove adapter




          #widgets.row(ng-switch-when='addDialog')
            .col-md-12
              .widget
                .inner
                  header: h2 Add a new dialog
                  section
                    form(role='form', name='forms.addDialog',
                    ng-submit='Dialog.add(dialog)')
                      .row
                        .form-group.col-lg-6.col-md-8(class='{{forms.addDialog.name.$invalid && forms.addDialog.name.$dirty && "has-error"}}')
                          input.form-control(type='text',
                          name='name',
                          ng-model='dialog.form.name',
                          placeholder='Dialog name'
                          required)
                          p
                            span.text-danger(ng-show="forms.addDialog.name.$error.required && forms.addDialog.name.$dirty")
                              | A name is required to make a new dialog.
                      .row
                        .form-group.col-lg-6.col-md-8(class='{{forms.addDialog.url.$invalid && forms.addDialog.url.$dirty && "has-error"}}')
                          input.form-control(type='url',
                          name='url',
                          ng-model='dialog.form.url',
                          placeholder='URL for dialog',
                          required)
                          p
                            span.text-danger(ng-show="forms.addDialog.url.$error.required && forms.addDialog.url.$dirty")
                              | A URL is required to make a new dialog.
                            span.text-danger(ng-show="forms.addDialog.url.$error.url")
                              | The entered URL isn't valid.
                      .form-group
                        button.btn.btn-default(type='submit') Create dialog
                      a(ng-click='setSection("dialogs")') &nbsp; or go back to the list.




          #widgets.row(ng-switch-when='dialogs')
            .col-md-12
              .widget.widget-right
                .inner
                  header
                    h2 Dialogs
                    button.btn.btn-default(type='button',
                    ng-click='setSection("addDialog")') Add a dialog
                  section
                    
                    .row
                      .col-md-3
                        p(ng-hide='loadingDialogs') Hold on dialogs are loading...
                        p(ng-show='dialogs.length < 1')
                          | There are no dialogs yet. Please add one.
                        ul.nav.nav-pills.nav-stacked(ng-hide='dialogs.length < 1')
                          li(ng-repeat='_dialog in dialogs',
                          class='{{(_dialog.id == dialog.id) && "active"}}')
                            a(ng-click='Dialog.open(_dialog)') {{_dialog.name}}
                      .col-md-9(ng-show='dialogs.length < 1')
                      .col-md-9(ng-hide='dialogs.length < 1')
                        .row
                          .col-md-6
                            form(name='forms.details')
                              fieldset
                                legend Details
                                .form-group
                                  label Dialog Id
                                  .row
                                    .col-md-9
                                      input.form-control(ng-model='dialog.id', readonly='')
                                .form-group
                                  label Name
                                  .row
                                    .col-md-9
                                      input.form-control(ng-model='dialog.name')
                                .form-group
                                  label URL
                                  input.form-control(ng-model='dialog.url')
                                .form-group
                                  button.btn.btn-default(ng-click='Dialog.updateDetails(dialog)') Update details
                          .col-md-4
                            form(name='forms.auth')
                              fieldset
                                legend Authentication 
                                  span.small.text-primary(ng-show='dialog.useBasicAuth') &nbsp;enabled
                                p If desired, you can set Basic Authentication credentials for this dialog.
                                p(ng-show='dialogAuth.message', class="{{(dialogAuth.messageType) && 'text-' + dialogAuth.messageType}}")
                                  | {{dialogAuth.message}}
                                div(ng-hide='dialogAuth.open')
                                  .form-group
                                    button.btn.btn-default(ng-click='dialogAuth.open = true') Configure
                                div(ng-show='dialogAuth.open')
                                  .form-group
                                    label Username
                                    input.form-control(name='username', ng-model='dialog.userName')
                                  .form-group
                                    label Password
                                    input.form-control(name='password', ng-model='dialog.password', type='password')
                                  .form-groups
                                    button.btn.btn-default(ng-click='authenticateDialog(dialog)')
                                      | {{(dialog.useBasicAuth) && 'Update' || 'Enable'}}
                                    button.btn.btn-default(ng-click='cancelAuthentication(dialog)')
                                      | Cancel
                                    button.btn.btn-danger.pull-right(ng-click='disableDialogAuthentication(dialog)',
                                      ng-show='dialog.useBasicAuth')
                                      | Disable

                          .col-md-2
                            button.btn.btn-default.btn-danger.pull-right(ng-click='Dialog.remove(dialog)')
                              | Delete dialog
                        .row
                          .col-md-10
                            form(name='forms.adapters', role='form')
                              fieldset
                                legend Adapters
                                .row
                                  .form-group.col-sm-5.col-lg-4
                                    label Type
                                    select.form-control(ng-model='channel.type',
                                    ng-change='channelTypeSelected()')
                                      option(ng-repeat='type in types',
                                      value='{{type}}') {{type}}
                                    span.help-block Please select a type first
                                  .form-group.col-sm-7(ng-hide='(channel.type == null)')
                                        label Adapter
                                        p(ng-hide='candidates.length > 0')
                                          | There are sadly no adapters for this one.
                                        select.form-control(ng-model='channel.adapter',
                                        ng-show='candidates.length > 0')
                                          option(ng-repeat='candidate in candidates',
                                          value='{{candidate.configId}}') {{candidate.myAddress}}
                                        span.help-block Select the adapter
                                .row
                                  .form-group.col-md-12
                                    button.btn.btn-default(type='button',
                                    ng-click='Dialog.adapters.add(dialog)') Link adapter to dialog
                        hr
                        fieldset
                          legend Linked Adapters
                          p(ng-hide='(adapters | filterAdapters: dialog).length > 0')
                            | There are no adapters linked to this dialog yet.
                          table.table.table-bordered.table-hover(
                          ng-show='(adapters | filterAdapters: dialog).length > 0')
                            thead
                              tr
                                th Adapter
                                th Type
                                th Actions
                            tbody
                              tr(ng-repeat='adapter in adapters | filterAdapters: dialog')
                                th {{adapter | translateAdapterAddress}}
                                th {{adapter | translateAdapterType}}
                                th: a(ng-click='Dialog.adapters.remove(adapter)') Remove link




          #widgets.row(ng-switch-when='debugger')
            .col-md-12
              .widget
                .inner
                  header: h2 Debugger
                  section
                    form.form-inline(role='form')
                      .form-group
                        label DDR Type:
                        select.form-control(ng-model='query.category',
                        ng-change='Log.categorize()')
                          option(value='ALL') All
                          option(value='OUTGOING') Outgoing
                          option(value='INCOMING') Incoming
                          option(value='ADAPTER') Adapter Purchase
                          option(value='SERVICE') Service Cost
                          option(value='START_UP') Start Up Cost
                          option(value='SUBSCRIPTION') Subscription Cost
                          option(value='TTS') TTS Cost
                      .form-group(style='margin-left: 15px;')
                        label Limit:
                        select.form-control(ng-model='query.limit',
                        ng-change='Log.list()')
                          option(value='100') 100
                          option(value='250') 250
                          option(value='500') 500
                          option(value='1000') 1000
                      .form-group
                        label Logs until 
                          //- span.small.text-muted dd/mm/yyyy
                        input.form-control(ng-model='query.until',
                        ng-change='Log.period()',
                        data-date-type='string',
                        data-date-format='dd/MM/yyyy',
                        bs-datepicker='')
                      .form-group
                        label Filter
                        input.form-control(type='text',
                        ng-model='queryLogs')
                    hr
                    p(ng-show='loading.logs')
                      | Loading logs..
                    p(ng-hide='logs.length > 0 || loading.logs')
                      | Your query has no logs..
                    table.table(ng-show='logs.length > 0')
                      thead
                        tr
                          th Date
                          th Type
                          th From
                          th To
                      tbody
                        tr(ng-repeat='log in logs | filter:queryLogs | orderBy: "start" : true')
                          td <a href="/#/developer?ddrId={{log._id}}">{{log.startString}}<a>
                          td {{log.ddrTypeString}}
                          td {{log.fromAddress}}
                          td {{log.toAddress}}
          #widgets.row(ng-switch-when='details')
            .col-md-12
              .widget
                .inner
                  header: h2 Details for {{ddrId}}
                  section.ddr-detail
                    .row
                      .col-md-4.col-md-offset-2.ddr-details
                        dl.dl-horizontal
                          dt Type
                          dd {{ddrDetails.ddrTypeString}}
                          dt Duration
                          dd(ng-show='ddrDetails.duration !== null') {{ddrDetails.duration}} ms
                          dd(ng-show='ddrDetails.duration === null') No duration
                          dt Start Time
                          dd {{ddrDetails.startString}}
                          dt(ng-show='ddrDetails.duration !== null') End Time
                          dd(ng-show='ddrDetails.duration !== null') {{ddrDetails.endString}}
                          hr
                          dt From
                          dd {{ddrDetails.fromAddress}}
                          dt To
                          dd {{ddrDetails.toAddress}}
                      .col-md-4
                        div(ng-show='ddrDetails.statusPerAddress')
                          h5 Address Status
                          dl.dl-horizontal
                            div(ng-repeat='statusObj in ddrDetails.statusPerAddress')
                              dt {{statusObj.index}}
                              dd {{statusObj.status}}
                        div(ng-show='ddrDetails.additionalInfo.message')
                          h5 Message
                          .well
                            pre
                              | {{ddrDetails.additionalInfo.message}}
                          
                      .col-sm-8.col-sm-offset-2
                        .row(ng-show='logs')
                          .col-xs-5
                            strong Time 
                          .col-xs-2
                            strong Level 
                          .col-xs-5
                            button.pull-right.btn.btn-default(ng-click='expandAll()') Expand All
                            button.pull-right.btn.btn-default(ng-click='collapseAll()') Collapse All
                          hr
                      .col-sm-8.col-sm-offset-2
                        div(ng-repeat='log in logs | orderBy: "timestamp"')
                          //.panel(ng-class='log.level === "INFO" ? "panel-primary" : "panel-default"')
                          .panel(ng-class='{INFO:"panel-info", SEVERE: "panel-danger", DDR: "panel-default", DEBUG: "panel-success", WARNING: "panel-warning" }[log.level]')
                            .panel-heading
                              a(data-toggle='collapse', href='#collapse{{$index}}')
                                .row
                                  .col-xs-5
                                    | {{log.timeString}}
                                  .col-xs-5
                                    | {{log.level}}
                                      
                            .panel-body.panel-collapse.collapse(id='collapse{{$index}}')
                              .container
                                dl
                                  dt Timestamp
                                  dd {{log.timestamp}}
                              div(ng-show='log.message')
                                h5 Message
                                .well
                                  pre
                                    | {{log.message}}
